local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local ThumbType = Enum.ThumbnailType.HeadShot
local ThumbSize = Enum.ThumbnailSize.Size100x100

local function formatNumber(num)
    if not num or num == 0 then 
        return "0" 
    end
    local suffixes = {"", "K", "M", "B", "T", "Qa", "Qi"}
    local i = 1
    while num >= 1000 and i < #suffixes do
        num = num / 1000
        i = i + 1
    end
    if math.floor(num) == num then
        return string.format("%d%s", num, suffixes[i])
    else
        return string.format("%.2f%s", num, suffixes[i])
    end
end

local gui = Instance.new("ScreenGui", game.CoreGui)
gui.Name = "SadUI"

local mainFrame = Instance.new("Frame", gui)
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.fromScale(0.55, 0.65)
mainFrame.Position = UDim2.fromScale(0.225, 0.15)
mainFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
mainFrame.BorderSizePixel = 0
mainFrame.Active = true
mainFrame.Draggable = true
Instance.new("UICorner", mainFrame).CornerRadius = UDim.new(0, 8)

local topBar = Instance.new("Frame", mainFrame)
topBar.Size = UDim2.new(1, 0, 0, 35)
topBar.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
topBar.BorderSizePixel = 0
Instance.new("UICorner", topBar).CornerRadius = UDim.new(0, 6)

local killauraBtn = Instance.new("TextButton", topBar)
killauraBtn.Size = UDim2.new(0, 120, 1, 0)
killauraBtn.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
killauraBtn.Text = "View Stats"
killauraBtn.TextColor3 = Color3.fromRGB(255,255,255)
killauraBtn.Font = Enum.Font.SourceSansBold
killauraBtn.TextSize = 18
Instance.new("UICorner", killauraBtn).CornerRadius = UDim.new(0, 6)

local minimizeBtn = Instance.new("TextButton", topBar)
minimizeBtn.Size = UDim2.new(0, 35, 1, 0)
minimizeBtn.Position = UDim2.new(1, -70, 0, 0)
minimizeBtn.Text = "-"
minimizeBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
minimizeBtn.TextColor3 = Color3.fromRGB(255,255,255)
minimizeBtn.Font = Enum.Font.SourceSansBold
minimizeBtn.TextSize = 20
Instance.new("UICorner", minimizeBtn).CornerRadius = UDim.new(0, 6)

local closeBtn = Instance.new("TextButton", topBar)
closeBtn.Size = UDim2.new(0, 35, 1, 0)
closeBtn.Position = UDim2.new(1, -35, 0, 0)
closeBtn.Text = "X"
closeBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
closeBtn.TextColor3 = Color3.fromRGB(255,255,255)
closeBtn.Font = Enum.Font.SourceSansBold
closeBtn.TextSize = 20
Instance.new("UICorner", closeBtn).CornerRadius = UDim.new(0, 6)

local playerList = Instance.new("ScrollingFrame", mainFrame)
playerList.Size = UDim2.new(1, -10, 1, -45)
playerList.Position = UDim2.new(0, 5, 0, 40)
playerList.CanvasSize = UDim2.new(0,0,0,0)
playerList.ScrollBarThickness = 6
playerList.BackgroundTransparency = 1

local listLayout = Instance.new("UIListLayout", playerList)
listLayout.Padding = UDim.new(0,4)
listLayout.SortOrder = Enum.SortOrder.LayoutOrder

listLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    playerList.CanvasSize = UDim2.new(0,0,0,listLayout.AbsoluteContentSize.Y + 10)
end)

local function findStat(plr, statName)
    for _,desc in ipairs(plr:GetDescendants()) do
        if desc.Name == statName and (desc:IsA("IntValue") or desc:IsA("NumberValue")) then
            return desc
        end
    end
    return nil
end

local playerFrames = {}

local function addPlayer(plr)
    local frame = Instance.new("Frame", playerList)
    frame.Size = UDim2.new(1, -5, 0, 45)
    frame.BackgroundColor3 = Color3.fromRGB(90,0,180)
    frame.BorderSizePixel = 0
    Instance.new("UICorner", frame).CornerRadius = UDim.new(0,6)

    playerFrames[plr] = frame

    local thumb = Instance.new("ImageLabel", frame)
    thumb.Size = UDim2.new(0,40,0,40)
    thumb.Position = UDim2.new(0,3,0.5,-20)
    thumb.BackgroundTransparency = 1
    local content, _ = Players:GetUserThumbnailAsync(plr.UserId, ThumbType, ThumbSize)
    thumb.Image = content

    local nameLabel = Instance.new("TextLabel", frame)
    nameLabel.Size = UDim2.new(0.45,0,1,0)
    nameLabel.Position = UDim2.new(0,50,0,0)
    nameLabel.BackgroundTransparency = 1
    nameLabel.Text = plr.DisplayName .. " (@"..plr.Name..")"
    nameLabel.Font = Enum.Font.SourceSansBold
    nameLabel.TextColor3 = Color3.fromRGB(255,255,255)
    nameLabel.TextSize = 16
    nameLabel.TextXAlignment = Enum.TextXAlignment.Left

    local durability = Instance.new("TextLabel", frame)
    durability.Size = UDim2.new(0.25,0,1,0)
    durability.Position = UDim2.new(0.55,0,0,0)
    durability.BackgroundTransparency = 1
    durability.Text = "Durability: 0"
    durability.Font = Enum.Font.SourceSansBold
    durability.TextColor3 = Color3.fromRGB(0,200,255)
    durability.TextSize = 16
    durability.TextXAlignment = Enum.TextXAlignment.Left

    local strength = Instance.new("TextLabel", frame)
    strength.Size = UDim2.new(0.25,0,1,0)
    strength.Position = UDim2.new(0.8,0,0,0)
    strength.BackgroundTransparency = 1
    strength.Text = "Strength: 0"
    strength.Font = Enum.Font.SourceSansBold
    strength.TextColor3 = Color3.fromRGB(255,150,0)
    strength.TextSize = 16
    strength.TextXAlignment = Enum.TextXAlignment.Left

    local function updateStats()
        local d = findStat(plr,"Durability")
        if d then durability.Text = "Durability: "..formatNumber(d.Value) end
        local s = findStat(plr,"Strength")
        if s then strength.Text = "Strength: "..formatNumber(s.Value) end
    end
    updateStats()

    local d = findStat(plr,"Durability")
    if d then d.Changed:Connect(updateStats) end
    local s = findStat(plr,"Strength")
    if s then s.Changed:Connect(updateStats) end
end

local function removePlayer(plr)
    local frame = playerFrames[plr]
    if frame then
        frame:Destroy()
        playerFrames[plr] = nil
    end
end

for _,plr in ipairs(Players:GetPlayers()) do
    addPlayer(plr)
end
Players.PlayerAdded:Connect(addPlayer)
Players.PlayerRemoving:Connect(removePlayer)

closeBtn.MouseButton1Click:Connect(function()
    gui:Destroy()
end)

local minimized = false
local miniFrame
minimizeBtn.MouseButton1Click:Connect(function()
    if not minimized then
        mainFrame.Visible = false
        miniFrame = Instance.new("Frame", gui)
        miniFrame.Size = UDim2.new(0,250,0,40)
        miniFrame.Position = UDim2.new(0.35,0,0,10)
        miniFrame.BackgroundColor3 = Color3.fromRGB(40,40,40)
        miniFrame.Active = true
        miniFrame.Draggable = true
        Instance.new("UICorner", miniFrame).CornerRadius = UDim.new(0,8)

        local btn = Instance.new("TextButton", miniFrame)
        btn.Size = UDim2.new(1,0,1,0)
        btn.BackgroundTransparency = 1
        btn.Text = "Sad v1.0.0.2 | See Stats"
        btn.Font = Enum.Font.SourceSansBold
        btn.TextSize = 18
        btn.TextColor3 = Color3.fromRGB(0,100,255)

        btn.MouseButton1Click:Connect(function()
            mainFrame.Visible = true
            miniFrame:Destroy()
            minimized = false
        end)

        minimized = true
    end
end)
