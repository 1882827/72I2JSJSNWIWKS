local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local ThumbType = Enum.ThumbnailType.HeadShot
local ThumbSize = Enum.ThumbnailSize.Size100x100

-- Number format function
local function formatNumber(num)
    if not num then return "0" end
    local suffixes = {"", "K", "M", "B", "T", "Qa", "Qi"}
    local i = 1
    while num >= 1000 and i < #suffixes do
        num = num / 1000
        i = i + 1
    end
    return string.format("%.2f%s", num, suffixes[i])
end

-- Main Gui
local gui = Instance.new("ScreenGui", game.CoreGui)
gui.Name = "SadUI"

local mainFrame = Instance.new("Frame", gui)
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.fromScale(0.55, 0.65)
mainFrame.Position = UDim2.fromScale(0.225, 0.15)
mainFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
mainFrame.BorderSizePixel = 0
mainFrame.Active = true
mainFrame.Draggable = true
Instance.new("UICorner", mainFrame).CornerRadius = UDim.new(0, 8)

-- Top bar
local topBar = Instance.new("Frame", mainFrame)
topBar.Size = UDim2.new(1, 0, 0, 35)
topBar.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
topBar.BorderSizePixel = 0
Instance.new("UICorner", topBar).CornerRadius = UDim.new(0, 6)

-- Tab button (KillAura only)
local killauraBtn = Instance.new("TextButton", topBar)
killauraBtn.Size = UDim2.new(0, 120, 1, 0)
killauraBtn.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
killauraBtn.Text = "KillAura"
killauraBtn.TextColor3 = Color3.fromRGB(255,255,255)
killauraBtn.Font = Enum.Font.SourceSansBold
killauraBtn.TextSize = 18
Instance.new("UICorner", killauraBtn).CornerRadius = UDim.new(0, 6)

-- Minimize and Close
local minimizeBtn = Instance.new("TextButton", topBar)
minimizeBtn.Size = UDim2.new(0, 35, 1, 0)
minimizeBtn.Position = UDim2.new(1, -70, 0, 0)
minimizeBtn.Text = "-"
minimizeBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
minimizeBtn.TextColor3 = Color3.fromRGB(255,255,255)
minimizeBtn.Font = Enum.Font.SourceSansBold
minimizeBtn.TextSize = 20
Instance.new("UICorner", minimizeBtn).CornerRadius = UDim.new(0, 6)

local closeBtn = Instance.new("TextButton", topBar)
closeBtn.Size = UDim2.new(0, 35, 1, 0)
closeBtn.Position = UDim2.new(1, -35, 0, 0)
closeBtn.Text = "X"
closeBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
closeBtn.TextColor3 = Color3.fromRGB(255,255,255)
closeBtn.Font = Enum.Font.SourceSansBold
closeBtn.TextSize = 20
Instance.new("UICorner", closeBtn).CornerRadius = UDim.new(0, 6)

-- Player list
local playerList = Instance.new("ScrollingFrame", mainFrame)
playerList.Size = UDim2.new(1, -10, 1, -45)
playerList.Position = UDim2.new(0, 5, 0, 40)
playerList.CanvasSize = UDim2.new(0,0,0,0)
playerList.ScrollBarThickness = 6
playerList.BackgroundTransparency = 1

local listLayout = Instance.new("UIListLayout", playerList)
listLayout.Padding = UDim.new(0,4)
listLayout.SortOrder = Enum.SortOrder.LayoutOrder

-- Function to add player
local function addPlayer(plr)
    local frame = Instance.new("Frame", playerList)
    frame.Size = UDim2.new(1, -5, 0, 45)
    frame.BackgroundColor3 = Color3.fromRGB(90,0,180) -- purple
    frame.BorderSizePixel = 0
    Instance.new("UICorner", frame).CornerRadius = UDim.new(0,6)

    local thumb = Instance.new("ImageLabel", frame)
    thumb.Size = UDim2.new(0,40,0,40)
    thumb.Position = UDim2.new(0,3,0.5,-20)
    thumb.BackgroundTransparency = 1
    local content, isReady = Players:GetUserThumbnailAsync(plr.UserId, ThumbType, ThumbSize)
    thumb.Image = content

    local nameLabel = Instance.new("TextLabel", frame)
    nameLabel.Size = UDim2.new(0.45,0,1,0)
    nameLabel.Position = UDim2.new(0,50,0,0)
    nameLabel.BackgroundTransparency = 1
    nameLabel.Text = plr.DisplayName .. " (@"..plr.Name..")"
    nameLabel.Font = Enum.Font.SourceSansBold
    nameLabel.TextColor3 = Color3.fromRGB(255,255,255)
    nameLabel.TextSize = 16
    nameLabel.TextXAlignment = Enum.TextXAlignment.Left

    local durability = Instance.new("TextLabel", frame)
    durability.Size = UDim2.new(0.25,0,1,0)
    durability.Position = UDim2.new(0.55,0,0,0)
    durability.BackgroundTransparency = 1
    durability.Text = "Durability: 0"
    durability.Font = Enum.Font.SourceSansBold
    durability.TextColor3 = Color3.fromRGB(0,200,255)
    durability.TextSize = 16
    durability.TextXAlignment = Enum.TextXAlignment.Left

    local strength = Instance.new("TextLabel", frame)
    strength.Size = UDim2.new(0.25,0,1,0)
    strength.Position = UDim2.new(0.8,0,0,0)
    strength.BackgroundTransparency = 1
    strength.Text = "Strength: 0"
    strength.Font = Enum.Font.SourceSansBold
    strength.TextColor3 = Color3.fromRGB(255,150,0)
    strength.TextSize = 16
    strength.TextXAlignment = Enum.TextXAlignment.Left

    local function updateStats()
        local stats = plr:FindFirstChild("leaderstats")
        if stats then
            local d = stats:FindFirstChild("Durability")
            if d then
                durability.Text = "Durability: "..formatNumber(d.Value)
            end
            local s = stats:FindFirstChild("Strength")
            if s then
                strength.Text = "Strength: "..formatNumber(s.Value)
            end
        end
    end
    updateStats()

    if plr:FindFirstChild("leaderstats") then
        if plr.leaderstats:FindFirstChild("Durability") then
            plr.leaderstats.Durability.Changed:Connect(updateStats)
        end
        if plr.leaderstats:FindFirstChild("Strength") then
            plr.leaderstats.Strength.Changed:Connect(updateStats)
        end
    end
end

-- Load all players
for _,plr in ipairs(Players:GetPlayers()) do
    addPlayer(plr)
end
Players.PlayerAdded:Connect(addPlayer)

-- Close and Minimize functions
closeBtn.MouseButton1Click:Connect(function()
    gui:Destroy()
end)

local minimized = false
local miniFrame
minimizeBtn.MouseButton1Click:Connect(function()
    if not minimized then
        mainFrame.Visible = false
        miniFrame = Instance.new("Frame", gui)
        miniFrame.Size = UDim2.new(0,250,0,40)
        miniFrame.Position = UDim2.new(0.35,0,0,10)
        miniFrame.BackgroundColor3 = Color3.fromRGB(40,40,40)
        miniFrame.Active = true
        miniFrame.Draggable = true
        Instance.new("UICorner", miniFrame).CornerRadius = UDim.new(0,8)

        local miniLabel = Instance.new("TextLabel", miniFrame)
        miniLabel.Size = UDim2.new(1,0,1,0)
        miniLabel.BackgroundTransparency = 1
        miniLabel.Text = "Sad v1.0.0.2 | See Stats"
        miniLabel.Font = Enum.Font.SourceSansBold
        miniLabel.TextSize = 18
        miniLabel.TextColor3 = Color3.fromRGB(0,100,255)

        miniFrame.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                mainFrame.Visible = true
                miniFrame:Destroy()
                minimized = false
            end
        end)
        minimized = true
    end
end)
